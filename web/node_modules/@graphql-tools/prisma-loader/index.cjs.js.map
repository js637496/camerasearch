{"version":3,"file":"index.cjs.js","sources":["../../../dist/loaders/prisma/src/index.js"],"sourcesContent":["import { UrlLoader } from '@graphql-tools/url-loader';\nimport { PrismaDefinitionClass, Environment } from 'prisma-yml';\nimport { join } from 'path';\nimport { pathExists } from 'fs-extra';\nimport { homedir } from 'os';\nimport { cwd } from 'process';\n/**\n * This loader loads a schema from a `prisma.yml` file\n */\nexport class PrismaLoader extends UrlLoader {\n    loaderId() {\n        return 'prisma';\n    }\n    async canLoad(prismaConfigFilePath, options) {\n        if (typeof prismaConfigFilePath === 'string' && prismaConfigFilePath.endsWith('prisma.yml')) {\n            const joinedYmlPath = join(options.cwd || cwd(), prismaConfigFilePath);\n            return pathExists(joinedYmlPath);\n        }\n        return false;\n    }\n    async load(prismaConfigFilePath, options) {\n        const { graceful, envVars = {} } = options;\n        const home = homedir();\n        const env = new Environment(home);\n        await env.load();\n        const joinedYmlPath = join(options.cwd || cwd(), prismaConfigFilePath);\n        const definition = new PrismaDefinitionClass(env, joinedYmlPath, envVars);\n        await definition.load({}, undefined, graceful);\n        const serviceName = definition.service;\n        const stage = definition.stage;\n        const clusterName = definition.cluster;\n        if (!clusterName) {\n            throw new Error(`No cluster set. Please set the \"cluster\" property in your prisma.yml`);\n        }\n        const cluster = await definition.getCluster();\n        if (!cluster) {\n            throw new Error(`Cluster ${clusterName} provided in prisma.yml could not be found in global ~/.prisma/config.yml.\n      Please check in ~/.prisma/config.yml, if the cluster exists.\n      You can use \\`docker-compose up -d\\` to start a new cluster.`);\n        }\n        const token = definition.getToken(serviceName, stage);\n        const url = cluster.getApiEndpoint(serviceName, stage, definition.getWorkspace() || undefined);\n        const headers = token\n            ? {\n                Authorization: `Bearer ${token}`,\n            }\n            : undefined;\n        return super.load(url, { headers });\n    }\n}\n//# sourceMappingURL=index.js.map"],"names":["UrlLoader","join","cwd","pathExists","homedir","Environment","PrismaDefinitionClass"],"mappings":";;;;;;;;;;;AAMA;AACA;AACA;AACO,MAAM,YAAY,SAASA,mBAAS,CAAC;AAC5C,IAAI,QAAQ,GAAG;AACf,QAAQ,OAAO,QAAQ,CAAC;AACxB,KAAK;AACL,IAAI,MAAM,OAAO,CAAC,oBAAoB,EAAE,OAAO,EAAE;AACjD,QAAQ,IAAI,OAAO,oBAAoB,KAAK,QAAQ,IAAI,oBAAoB,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE;AACrG,YAAY,MAAM,aAAa,GAAGC,SAAI,CAAC,OAAO,CAAC,GAAG,IAAIC,WAAG,EAAE,EAAE,oBAAoB,CAAC,CAAC;AACnF,YAAY,OAAOC,kBAAU,CAAC,aAAa,CAAC,CAAC;AAC7C,SAAS;AACT,QAAQ,OAAO,KAAK,CAAC;AACrB,KAAK;AACL,IAAI,MAAM,IAAI,CAAC,oBAAoB,EAAE,OAAO,EAAE;AAC9C,QAAQ,MAAM,EAAE,QAAQ,EAAE,OAAO,GAAG,EAAE,EAAE,GAAG,OAAO,CAAC;AACnD,QAAQ,MAAM,IAAI,GAAGC,UAAO,EAAE,CAAC;AAC/B,QAAQ,MAAM,GAAG,GAAG,IAAIC,qBAAW,CAAC,IAAI,CAAC,CAAC;AAC1C,QAAQ,MAAM,GAAG,CAAC,IAAI,EAAE,CAAC;AACzB,QAAQ,MAAM,aAAa,GAAGJ,SAAI,CAAC,OAAO,CAAC,GAAG,IAAIC,WAAG,EAAE,EAAE,oBAAoB,CAAC,CAAC;AAC/E,QAAQ,MAAM,UAAU,GAAG,IAAII,+BAAqB,CAAC,GAAG,EAAE,aAAa,EAAE,OAAO,CAAC,CAAC;AAClF,QAAQ,MAAM,UAAU,CAAC,IAAI,CAAC,EAAE,EAAE,SAAS,EAAE,QAAQ,CAAC,CAAC;AACvD,QAAQ,MAAM,WAAW,GAAG,UAAU,CAAC,OAAO,CAAC;AAC/C,QAAQ,MAAM,KAAK,GAAG,UAAU,CAAC,KAAK,CAAC;AACvC,QAAQ,MAAM,WAAW,GAAG,UAAU,CAAC,OAAO,CAAC;AAC/C,QAAQ,IAAI,CAAC,WAAW,EAAE;AAC1B,YAAY,MAAM,IAAI,KAAK,CAAC,CAAC,oEAAoE,CAAC,CAAC,CAAC;AACpG,SAAS;AACT,QAAQ,MAAM,OAAO,GAAG,MAAM,UAAU,CAAC,UAAU,EAAE,CAAC;AACtD,QAAQ,IAAI,CAAC,OAAO,EAAE;AACtB,YAAY,MAAM,IAAI,KAAK,CAAC,CAAC,QAAQ,EAAE,WAAW,CAAC;AACnD;AACA,kEAAkE,CAAC,CAAC,CAAC;AACrE,SAAS;AACT,QAAQ,MAAM,KAAK,GAAG,UAAU,CAAC,QAAQ,CAAC,WAAW,EAAE,KAAK,CAAC,CAAC;AAC9D,QAAQ,MAAM,GAAG,GAAG,OAAO,CAAC,cAAc,CAAC,WAAW,EAAE,KAAK,EAAE,UAAU,CAAC,YAAY,EAAE,IAAI,SAAS,CAAC,CAAC;AACvG,QAAQ,MAAM,OAAO,GAAG,KAAK;AAC7B,cAAc;AACd,gBAAgB,aAAa,EAAE,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC;AAChD,aAAa;AACb,cAAc,SAAS,CAAC;AACxB,QAAQ,OAAO,KAAK,CAAC,IAAI,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;AAC5C,KAAK;AACL;;;;"}